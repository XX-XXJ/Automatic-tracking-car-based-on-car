C51 COMPILER V9.57.0.0   MOTOR                                                             06/30/2025 14:48:52 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN .\Objects\MOTOR.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE MOTOR.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\MOT
                    -OR.lst) TABS(2) OBJECT(.\Objects\MOTOR.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "MOTOR.h"
   3          
   4          float Lspeed=0;
   5          float Rspeed=0;
   6          
   7          /*--------------------------------------------------
   8           电机停止函数（所有引脚拉低）
   9          --------------------------------------------------*/
  10          void Motor_Stop(void)
  11          {
  12   1          INA = 0;
  13   1          INB = 0;
  14   1          INA2 = 0;
  15   1          INB2 = 0;
  16   1      }
  17          
  18          /*--------------------------------------------------
  19           电机初始化函数
  20          --------------------------------------------------*/
  21          void Motor_Init(void)
  22          {
  23   1          Motor_Stop();  // 启动前先停止电机
  24   1      }
  25          
  26          /*--------------------------------------------------
  27           设置左右电机速度（单位：-100 ~ 100）
  28           正值：正转，负值：反转，0：停止
  29          --------------------------------------------------*/
  30          void Motor_SetSpeed(float left, float right)
  31          {
  32   1          if(left > 100) left = 100;
  33   1          if(left < -100) left = -100;
  34   1          if(right > 100) right = 100;
  35   1          if(right < -100) right = -100;
  36   1      
  37   1          Lspeed = left;
  38   1          Rspeed = right;
  39   1      }
  40          
  41          
  42          /*--------------------------------------------------
  43           PWM占空比控制（在定时器中断中调用）
  44           参数：pwm_count 为 0 ~ 99 的占空比计数器
  45          --------------------------------------------------*/
  46          void Motor_PWM_Control(unsigned char pwm_count)
  47          {
  48   1          // 左电机
  49   1          if(Lspeed > 0)
  50   1          {
  51   2              if(pwm_count < Lspeed)
  52   2              {
  53   3                  INA = 1;
  54   3                  INB = 0;
C51 COMPILER V9.57.0.0   MOTOR                                                             06/30/2025 14:48:52 PAGE 2   

  55   3              }
  56   2              else
  57   2              {
  58   3                  INA = 0;
  59   3                  INB = 0;
  60   3              }
  61   2          }
  62   1          else
  63   1          {
  64   2              if(pwm_count < -Lspeed)
  65   2              {
  66   3                  INA = 0;
  67   3                  INB = 1;
  68   3              }
  69   2              else
  70   2              {
  71   3                  INA = 0;
  72   3                  INB = 0;
  73   3              }
  74   2          }
  75   1      
  76   1          // 右电机
  77   1          if(Rspeed > 0)
  78   1          {
  79   2              if(pwm_count < Rspeed)
  80   2              {
  81   3                  INA2 = 1;
  82   3                  INB2 = 0;
  83   3              }
  84   2              else
  85   2              {
  86   3                  INA2 = 0;
  87   3                  INB2 = 0;
  88   3              }
  89   2          }
  90   1          else
  91   1          {
  92   2              if(pwm_count < -Rspeed)
  93   2              {
  94   3                  INA2 = 0;
  95   3                  INB2 = 1;
  96   3              }
  97   2              else
  98   2              {
  99   3                  INA2 = 0;
 100   3                  INB2 = 0;
 101   3              }
 102   2          }
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    380    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
