C51 COMPILER V9.57.0.0   MAIN                                                              06/30/2025 14:48:51 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "MOTOR.h"
   3          #include "SENSOR.h"
   4          #include "PID.h"
   5          #include "TIMER.h"
   6          #include "UART.h"
   7          #include "Delay.h"
   8          #include "LCD1602.h"
   9          
  10          unsigned char PWM_Count = 0;
  11          float target_speed = 80;
  12          float err,output;
  13          
  14          
  15          
  16          void Display(float a, float b)
  17          {   
  18   1          int l_int;
  19   1          int r_int;
  20   1          l_int = (int)(a * 10);
  21   1          r_int = (int)(b * 10);
  22   1          // === 显示左速度 ===
  23   1          LCD_ShowString(1, 1, "LSpeed:      ");  // 保留足够空位
  24   1          if (l_int < 0)
  25   1          {
  26   2              LCD_ShowChar(1, 8, '-');
  27   2              l_int = -l_int;
  28   2          }
  29   1          else
  30   1          {
  31   2              LCD_ShowChar(1, 8, '+');
  32   2          }
  33   1      
  34   1          LCD_ShowNum(1, 9, l_int / 10, 2);   // 整数部分
  35   1          LCD_ShowChar(1, 11, '.');
  36   1          LCD_ShowNum(1, 12, l_int % 10, 1);  // 小数部分
  37   1      
  38   1          // === 显示右速度 ===
  39   1          LCD_ShowString(2, 1, "RSpeed:      ");
  40   1          if (r_int < 0)
  41   1          {
  42   2              LCD_ShowChar(2, 8, '-');
  43   2              r_int = -r_int;
  44   2          }
  45   1          else
  46   1          {
  47   2              LCD_ShowChar(2, 8, '+');
  48   2          }
  49   1      
  50   1          LCD_ShowNum(2, 9, r_int / 10, 2);
  51   1          LCD_ShowChar(2, 11, '.');
  52   1          LCD_ShowNum(2, 12, r_int % 10, 1);
  53   1      }
  54          
C51 COMPILER V9.57.0.0   MAIN                                                              06/30/2025 14:48:51 PAGE 2   

  55          
  56          void main()
  57          {
  58   1          UART_Init();
  59   1          Motor_Init();
  60   1          Sensor_Init();
  61   1          PID_Init(60.0, 0.02, 2.0);
  62   1          LCD_Init();
  63   1          EA=0;
  64   1          TR0=0;
  65   1        
  66   1          
  67   1          while(1)
  68   1          {
  69   2            // 等待按键按下（带消抖）
  70   2            if(P3^7 == 0)  // 按键按下
  71   2            {
  72   3              Delay(20); // 消抖
  73   3              if(P3^7 == 0)
  74   3              {
  75   4                Timer0_Init();     // 启动定时器
  76   4                break;
  77   4              }
  78   3            }
  79   2          }
  80   1          while(1)
  81   1          {
  82   2            Display(Lspeed,Rspeed);
  83   2          }// 空循环，控制在中断中完成
  84   1      }
  85          
  86          void Timer0_ISR(void) interrupt 1
  87          {
  88   1          TL0 = 0xA4;
  89   1          TH0 = 0xFF;
  90   1          PWM_Count++;
  91   1          PWM_Count %= 80;
  92   1      
  93   1          err = Sensor_GetError();
  94   1          output = PID_Compute(err);
  95   1      
  96   1          Motor_SetSpeed(target_speed + output, target_speed - output);
  97   1          Motor_PWM_Control(PWM_Count);
  98   1      
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    529    ----
   CONSTANT SIZE    =     28    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
